<script>
const params = new URLSearchParams(window.location.search);
const type = params.get("type") || "valentine";

let finalURL = "";

// Safe Generate Function
function generate(){

  const youEl = document.getElementById("you");
  const partnerEl = document.getElementById("partner");
  const msgEl = document.getElementById("message");

  if(!youEl || !partnerEl || !msgEl){
    alert("Page setup error.");
    return;
  }

  const you = youEl.value.trim();
  const partner = partnerEl.value.trim();
  const msg = msgEl.value.trim();

  if(!you || !partner || !msg){
    alert("Please fill all fields ðŸ’•");
    return;
  }

  // SAFE relative path (no hardcoded repo name)
  finalURL =
    `proposal.html?type=${encodeURIComponent(type)}&you=${encodeURIComponent(you)}&partner=${encodeURIComponent(partner)}&msg=${encodeURIComponent(msg)}`;

  const urlBox = document.getElementById("urlBox");
  const afterGenerate = document.getElementById("afterGenerate");

  if(urlBox){
    urlBox.innerText = window.location.origin + window.location.pathname.replace("choose.html","") + finalURL;
  }

  if(afterGenerate){
    afterGenerate.classList.remove("hidden");
  }
}

// Copy
function copyLink(){
  if(!finalURL){
    alert("Generate link first ðŸ’•");
    return;
  }

  const fullURL =
    window.location.origin +
    window.location.pathname.replace("choose.html","") +
    finalURL;

  navigator.clipboard.writeText(fullURL)
    .then(() => alert("Link copied ðŸ”—"))
    .catch(() => alert("Copy failed"));
}

// Open in new tab
function openLink(){
  if(!finalURL){
    alert("Generate link first ðŸ’•");
    return;
  }

  window.open(finalURL, "_blank");
}
</script>
