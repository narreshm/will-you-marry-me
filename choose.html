<script>
const params = new URLSearchParams(window.location.search);
const type = params.get("type") || "valentine";

const titles = {
  valentine:"ðŸ’“ Valentine",
  marriage:"ðŸ’ Marriage",
  love:"â¤ï¸ Love",
  confession:"ðŸ’Œ Confession",
  anniversary:"ðŸ’• Anniversary",
  birthday:"ðŸŽ‚ Birthday"
};

// Safely set page title
const titleElement = document.getElementById("pageTitle");
if(titleElement){
  titleElement.innerText = titles[type] || "ðŸ’– Special Moment";
}

let finalURL = "";

function generate(){

  const youEl = document.getElementById("you");
  const partnerEl = document.getElementById("partner");
  const msgEl = document.getElementById("message");

  if(!youEl || !partnerEl || !msgEl){
    alert("Page setup error ðŸ’”");
    return;
  }

  const you = youEl.value.trim();
  const partner = partnerEl.value.trim();
  const msg = msgEl.value.trim();

  if(!you || !partner || !msg){
    alert("Please fill all fields ðŸ’•");
    return;
  }

  finalURL =
    `proposal.html?type=${encodeURIComponent(type)}&you=${encodeURIComponent(you)}&partner=${encodeURIComponent(partner)}&msg=${encodeURIComponent(msg)}`;

  const urlBox = document.getElementById("urlBox");
  const afterGenerate = document.getElementById("afterGenerate");

  if(urlBox){
    urlBox.innerText =
      window.location.origin +
      window.location.pathname.replace("choose.html","") +
      finalURL;
  }

  if(afterGenerate){
    afterGenerate.classList.remove("hidden");
  }
}

function copyLink(){
  if(!finalURL){
    alert("Generate link first ðŸ’•");
    return;
  }

  const fullURL =
    window.location.origin +
    window.location.pathname.replace("choose.html","") +
    finalURL;

  navigator.clipboard.writeText(fullURL)
    .then(()=>alert("Link copied ðŸ”—"))
    .catch(()=>alert("Copy failed"));
}

function openLink(){
  if(!finalURL){
    alert("Generate link first ðŸ’•");
    return;
  }

  window.open(finalURL,"_blank");
}
</script>
